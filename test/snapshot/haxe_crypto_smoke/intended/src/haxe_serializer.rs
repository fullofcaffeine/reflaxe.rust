// Generated by reflaxe.rust (POC)

static __HX_STATIC_USE_CACHE: std::sync::OnceLock<hxrt::cell::HxCell<bool>> =
    std::sync::OnceLock::new();
fn __hx_static_cell_use_cache() -> &'static hxrt::cell::HxCell<bool> {
    __HX_STATIC_USE_CACHE.get_or_init(|| hxrt::cell::HxCell::new(false))
}
pub(crate) fn __hx_static_get_use_cache() -> bool {
    __hx_static_cell_use_cache().borrow().clone()
}
pub(crate) fn __hx_static_set_use_cache(value: bool) {
    *__hx_static_cell_use_cache().borrow_mut() = value;
}

static __HX_STATIC_USE_ENUM_INDEX: std::sync::OnceLock<hxrt::cell::HxCell<bool>> =
    std::sync::OnceLock::new();
fn __hx_static_cell_use_enum_index() -> &'static hxrt::cell::HxCell<bool> {
    __HX_STATIC_USE_ENUM_INDEX.get_or_init(|| hxrt::cell::HxCell::new(false))
}
pub(crate) fn __hx_static_get_use_enum_index() -> bool {
    __hx_static_cell_use_enum_index().borrow().clone()
}
pub(crate) fn __hx_static_set_use_enum_index(value: bool) {
    *__hx_static_cell_use_enum_index().borrow_mut() = value;
}

static __HX_STATIC_BASE64: std::sync::OnceLock<hxrt::cell::HxCell<hxrt::string::HxString>> =
    std::sync::OnceLock::new();
fn __hx_static_cell_base64() -> &'static hxrt::cell::HxCell<hxrt::string::HxString> {
    __HX_STATIC_BASE64.get_or_init(|| {
        hxrt::cell::HxCell::new(hxrt::string::HxString::from(hxrt::string::HxString::from(
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",
        )))
    })
}
pub(crate) fn __hx_static_get_base64() -> hxrt::string::HxString {
    __hx_static_cell_base64().borrow().clone()
}
pub(crate) fn __hx_static_set_base64(value: hxrt::string::HxString) {
    *__hx_static_cell_base64().borrow_mut() = value;
}

static __HX_STATIC_BASE64_CODES: std::sync::OnceLock<
    hxrt::cell::HxCell<hxrt::array::Array<Option<i32>>>,
> = std::sync::OnceLock::new();
fn __hx_static_cell_base64_codes() -> &'static hxrt::cell::HxCell<hxrt::array::Array<Option<i32>>> {
    __HX_STATIC_BASE64_CODES
        .get_or_init(|| hxrt::cell::HxCell::new(hxrt::array::Array::<Option<i32>>::null()))
}
pub(crate) fn __hx_static_get_base64_codes() -> hxrt::array::Array<Option<i32>> {
    __hx_static_cell_base64_codes().borrow().clone()
}
pub(crate) fn __hx_static_set_base64_codes(value: hxrt::array::Array<Option<i32>>) {
    *__hx_static_cell_base64_codes().borrow_mut() = value;
}

pub const __HX_TYPE_ID: u32 = 0x024a7531u32;

#[derive(Debug)]

pub struct Serializer {
    buf: crate::HxRef<crate::string_buf::StringBuf>,
    cache: hxrt::array::Array<hxrt::dynamic::Dynamic>,
    shash: crate::HxRef<crate::haxe_ds_string_map::StringMap<i32>>,
    scount: i32,
    pub use_cache: bool,
    pub use_enum_index: bool,
}

impl Serializer {
    pub fn new() -> crate::HxRef<crate::haxe_serializer::Serializer> {
        let self_: crate::HxRef<crate::haxe_serializer::Serializer> =
            crate::HxRef::new(Serializer {
                buf: crate::string_buf::StringBuf::new(),
                cache: hxrt::array::Array::<hxrt::dynamic::Dynamic>::new(),
                shash: crate::haxe_ds_string_map::StringMap::<i32>::new(),
                scount: 0,
                use_cache: crate::haxe_serializer::__hx_static_get_use_cache(),
                use_enum_index: crate::haxe_serializer::__hx_static_get_use_enum_index(),
            });
        return self_;
    }

    pub fn to_string(self_: &crate::HxRefCell<Serializer>) -> hxrt::string::HxString {
        let __hx_this: crate::HxRef<crate::haxe_serializer::Serializer> = self_.self_ref();
        return hxrt::string::HxString::from(crate::string_buf::StringBuf::to_string(
            &*({
                let __b = __hx_this.borrow();
                __b.buf.clone()
            }),
        ));
    }

    fn serialize_string(self_: &crate::HxRefCell<Serializer>, s: hxrt::string::HxString) {
        let __hx_this: crate::HxRef<crate::haxe_serializer::Serializer> = self_.self_ref();
        let mut s = s;
        let x: Option<i32> = crate::haxe_ds_string_map::StringMap::get(
            &*({
                let __b = __hx_this.borrow();
                __b.shash.clone()
            }),
            hxrt::string::HxString::from(s.clone()),
        );
        if x.is_some() {
            crate::string_buf::StringBuf::add(
                &*({
                    let __b = __hx_this.borrow();
                    __b.buf.clone()
                }),
                hxrt::dynamic::from(hxrt::string::HxString::from("R")),
            );
            crate::string_buf::StringBuf::add(
                &*({
                    let __b = __hx_this.borrow();
                    __b.buf.clone()
                }),
                {
                    let __hx_opt = x;
                    match __hx_opt {
                        Some(__v) => hxrt::dynamic::from(__v),
                        None => hxrt::dynamic::Dynamic::null(),
                    }
                },
            );
            return;
        }
        crate::haxe_ds_string_map::StringMap::set(
            &*({
                let __b = __hx_this.borrow();
                __b.shash.clone()
            }),
            hxrt::string::HxString::from(s.clone()),
            {
                let __tmp = self_.borrow().scount;
                self_.borrow_mut().scount = __tmp + 1;
                __tmp
            },
        );
        crate::string_buf::StringBuf::add(
            &*({
                let __b = __hx_this.borrow();
                __b.buf.clone()
            }),
            hxrt::dynamic::from(hxrt::string::HxString::from("y")),
        );
        s = hxrt::string::HxString::from(crate::string_tools::StringTools::url_encode(
            hxrt::string::HxString::from(s.clone()),
        ));
        crate::string_buf::StringBuf::add(
            &*({
                let __b = __hx_this.borrow();
                __b.buf.clone()
            }),
            hxrt::dynamic::from(hxrt::string::len(s.as_str())),
        );
        crate::string_buf::StringBuf::add(
            &*({
                let __b = __hx_this.borrow();
                __b.buf.clone()
            }),
            hxrt::dynamic::from(hxrt::string::HxString::from(":")),
        );
        crate::string_buf::StringBuf::add(
            &*({
                let __b = __hx_this.borrow();
                __b.buf.clone()
            }),
            hxrt::dynamic::from(s.clone()),
        );
    }

    fn serialize_ref(self_: &crate::HxRefCell<Serializer>, v: hxrt::dynamic::Dynamic) -> bool {
        let __hx_this: crate::HxRef<crate::haxe_serializer::Serializer> = self_.self_ref();
        {
            let mut _g: i32 = 0;
            let _g1: i32 = ({
                let __b = __hx_this.borrow();
                __b.cache.clone()
            })
            .len() as i32;
            while _g < _g1 {
                let i: i32 = {
                    let __tmp = _g;
                    _g = _g + 1;
                    __tmp
                };
                if hxrt::dynamic::eq(
                    &({
                        let __b = __hx_this.borrow();
                        __b.cache.clone()
                    })
                    .get_unchecked(i as usize),
                    &v,
                ) {
                    crate::string_buf::StringBuf::add(
                        &*({
                            let __b = __hx_this.borrow();
                            __b.buf.clone()
                        }),
                        hxrt::dynamic::from(hxrt::string::HxString::from("r")),
                    );
                    crate::string_buf::StringBuf::add(
                        &*({
                            let __b = __hx_this.borrow();
                            __b.buf.clone()
                        }),
                        hxrt::dynamic::from(i),
                    );
                    return true;
                }
            }
        }
        ({
            let __b = __hx_this.borrow();
            __b.cache.clone()
        })
        .push(v.clone());
        return false;
    }

    fn serialize_fields(self_: &crate::HxRefCell<Serializer>, v: crate::HxRef<hxrt::anon::Anon>) {
        let __hx_this: crate::HxRef<crate::haxe_serializer::Serializer> = self_.self_ref();
        {
            let mut _g: i32 = 0;
            let _g1: hxrt::array::Array<hxrt::string::HxString> = {
                let __obj = v.clone();
                let __dyn = hxrt::dynamic::from(__obj);
                hxrt::dynamic::field_names(&__dyn)
            };
            while _g < (_g1.len() as i32) {
                let f: hxrt::string::HxString =
                    hxrt::string::HxString::from(_g1.get_unchecked(_g as usize));
                {
                    _g = _g + 1;
                    _g
                };
                crate::haxe_serializer::Serializer::serialize_string(
                    &*__hx_this,
                    hxrt::string::HxString::from(f.clone()),
                );
                crate::haxe_serializer::Serializer::serialize(&*__hx_this, {
                    let __obj = v.clone();
                    let __name = f.clone();
                    let __dyn = hxrt::dynamic::from(__obj);
                    hxrt::dynamic::field_get(&__dyn, __name.as_str())
                });
            }
        }
        crate::string_buf::StringBuf::add(
            &*({
                let __b = __hx_this.borrow();
                __b.buf.clone()
            }),
            hxrt::dynamic::from(hxrt::string::HxString::from("g")),
        );
    }

    pub fn serialize(self_: &crate::HxRefCell<Serializer>, v: hxrt::dynamic::Dynamic) {
        let __hx_this: crate::HxRef<crate::haxe_serializer::Serializer> = self_.self_ref();
        {
            let _g: crate::value_type::ValueType = {
                let __v = v.clone();
                let __dyn = __v;
                if __dyn.is_null() {
                    crate::value_type::ValueType::TNull
                } else {
                    if __dyn.downcast_ref::<i32>().is_some() {
                        crate::value_type::ValueType::TInt
                    } else {
                        if __dyn.downcast_ref::<f64>().is_some() {
                            crate::value_type::ValueType::TFloat
                        } else {
                            if __dyn.downcast_ref::<bool>().is_some() {
                                crate::value_type::ValueType::TBool
                            } else {
                                if __dyn.downcast_ref::<String>().is_some()
                                    || __dyn.downcast_ref::<hxrt::string::HxString>().is_some()
                                {
                                    crate::value_type::ValueType::TClass(0xbf34d7ecu32)
                                } else {
                                    crate::value_type::ValueType::TObject
                                }
                            }
                        }
                    }
                }
            };
            match _g.clone() {
                crate::value_type::ValueType::TNull => {
                    crate::string_buf::StringBuf::add(
                        &*({
                            let __b = __hx_this.borrow();
                            __b.buf.clone()
                        }),
                        hxrt::dynamic::from(hxrt::string::HxString::from("n")),
                    );
                }
                crate::value_type::ValueType::TInt => {
                    let v_2: i32 = {
                        let __hx_dyn = v.clone();
                        if __hx_dyn.is_null() {
                            hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access")))
                        } else {
                            __hx_dyn.downcast_ref::<i32>().unwrap().clone()
                        }
                    };
                    if v_2 == 0 {
                        crate::string_buf::StringBuf::add(
                            &*({
                                let __b = __hx_this.borrow();
                                __b.buf.clone()
                            }),
                            hxrt::dynamic::from(hxrt::string::HxString::from("z")),
                        );
                        return;
                    }
                    crate::string_buf::StringBuf::add(
                        &*({
                            let __b = __hx_this.borrow();
                            __b.buf.clone()
                        }),
                        hxrt::dynamic::from(hxrt::string::HxString::from("i")),
                    );
                    crate::string_buf::StringBuf::add(
                        &*({
                            let __b = __hx_this.borrow();
                            __b.buf.clone()
                        }),
                        hxrt::dynamic::from(v_2),
                    );
                }
                crate::value_type::ValueType::TFloat => {
                    let v_3: f64 = {
                        let __hx_dyn = v.clone();
                        if __hx_dyn.is_null() {
                            hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access")))
                        } else {
                            __hx_dyn.downcast_ref::<f64>().unwrap().clone()
                        }
                    };
                    if v_3.is_nan() {
                        crate::string_buf::StringBuf::add(
                            &*({
                                let __b = __hx_this.borrow();
                                __b.buf.clone()
                            }),
                            hxrt::dynamic::from(hxrt::string::HxString::from("k")),
                        );
                    } else {
                        if !v_3.is_finite() {
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                if v_3 < (0 as f64) {
                                    hxrt::dynamic::from(hxrt::string::HxString::from("m"))
                                } else {
                                    hxrt::dynamic::from(hxrt::string::HxString::from("p"))
                                },
                            );
                        } else {
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                hxrt::dynamic::from(hxrt::string::HxString::from("d")),
                            );
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                hxrt::dynamic::from(v_3),
                            );
                        }
                    }
                }
                crate::value_type::ValueType::TBool => {
                    crate::string_buf::StringBuf::add(
                        &*({
                            let __b = __hx_this.borrow();
                            __b.buf.clone()
                        }),
                        if {
                            let __hx_dyn = v;
                            if __hx_dyn.is_null() {
                                hxrt::exception::throw(hxrt::dynamic::from(String::from(
                                    "Null Access",
                                )))
                            } else {
                                __hx_dyn.downcast_ref::<bool>().unwrap().clone()
                            }
                        } {
                            hxrt::dynamic::from(hxrt::string::HxString::from("t"))
                        } else {
                            hxrt::dynamic::from(hxrt::string::HxString::from("f"))
                        },
                    );
                }
                crate::value_type::ValueType::TObject => {
                    if false {
                        let class_name: hxrt::string::HxString = hxrt::string::HxString::from({
                            let _ = v;
                            String::from("<unknown class>")
                        });
                        crate::string_buf::StringBuf::add(
                            &*({
                                let __b = __hx_this.borrow();
                                __b.buf.clone()
                            }),
                            hxrt::dynamic::from(hxrt::string::HxString::from("A")),
                        );
                        crate::haxe_serializer::Serializer::serialize_string(
                            &*__hx_this,
                            hxrt::string::HxString::from(class_name),
                        );
                    } else {
                        if false {
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                hxrt::dynamic::from(hxrt::string::HxString::from("B")),
                            );
                            crate::haxe_serializer::Serializer::serialize_string(
                                &*__hx_this,
                                hxrt::string::HxString::from({
                                    let _ = v;
                                    String::from("<unknown enum>")
                                }),
                            );
                        } else {
                            if ({
                                let __b = __hx_this.borrow();
                                __b.use_cache
                            }) && crate::haxe_serializer::Serializer::serialize_ref(
                                &*__hx_this,
                                v.clone(),
                            ) {
                                return;
                            }
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                hxrt::dynamic::from(hxrt::string::HxString::from("o")),
                            );
                            crate::haxe_serializer::Serializer::serialize_fields(&*__hx_this, {
                                let __hx_dyn = v.clone();
                                if __hx_dyn.is_null() {
                                    hxrt::exception::throw(hxrt::dynamic::from(String::from(
                                        "Null Access",
                                    )))
                                } else {
                                    __hx_dyn
                                        .downcast_ref::<crate::HxRef<hxrt::anon::Anon>>()
                                        .unwrap()
                                        .clone()
                                }
                            });
                        }
                    }
                }
                crate::value_type::ValueType::TFunction => {
                    hxrt::exception::throw(hxrt::dynamic::from(hxrt::string::HxString::from(
                        "Cannot serialize function",
                    )));
                }
                crate::value_type::ValueType::TClass(__p) => {
                    let _g_2: u32 = __p;
                    {
                        let c: u32 = _g_2;
                        {
                            if c == 0xbf34d7ecu32 {
                                crate::haxe_serializer::Serializer::serialize_string(
                                    &*__hx_this,
                                    {
                                        let __hx_dyn = v.clone();
                                        if __hx_dyn.is_null() {
                                            hxrt::string::HxString::null()
                                        } else {
                                            if __hx_dyn.downcast_ref::<String>().is_some() {
                                                hxrt::string::HxString::from(
                                                    __hx_dyn
                                                        .downcast_ref::<String>()
                                                        .unwrap()
                                                        .clone(),
                                                )
                                            } else {
                                                if __hx_dyn
                                                    .downcast_ref::<hxrt::string::HxString>()
                                                    .is_some()
                                                {
                                                    __hx_dyn
                                                        .downcast_ref::<hxrt::string::HxString>()
                                                        .unwrap()
                                                        .clone()
                                                } else {
                                                    hxrt::exception::throw(hxrt::dynamic::from(
                                                        String::from("Null Access"),
                                                    ))
                                                }
                                            }
                                        }
                                    },
                                );
                                return;
                            }
                            if ({
                                let __b = __hx_this.borrow();
                                __b.use_cache
                            }) && crate::haxe_serializer::Serializer::serialize_ref(
                                &*__hx_this,
                                v.clone(),
                            ) {
                                return;
                            }
                            {
                                let __s = c.clone();
                                if __s == 0x22689edau32.clone() {
                                    let mut ucount: i32 = 0;
                                    crate::string_buf::StringBuf::add(
                                        &*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }),
                                        hxrt::dynamic::from(hxrt::string::HxString::from("a")),
                                    );
                                    let l: i32 = {
                                        let __hx_dyn = hxrt::dynamic::index_get_str(
                                            &v,
                                            hxrt::string::HxString::from("length").as_str(),
                                        );
                                        if __hx_dyn.is_null() {
                                            hxrt::exception::throw(hxrt::dynamic::from(
                                                String::from("Null Access"),
                                            ))
                                        } else {
                                            __hx_dyn.downcast_ref::<i32>().unwrap().clone()
                                        }
                                    };
                                    {
                                        let mut _g_4: i32 = 0;
                                        let _g1_2: i32 = l;
                                        while _g_4 < _g1_2 {
                                            let i_4: i32 = {
                                                let __tmp = _g_4;
                                                _g_4 = _g_4 + 1;
                                                __tmp
                                            };
                                            if hxrt::dynamic::index_get_i32(&v, i_4).is_null() {
                                                {
                                                    let __tmp = ucount;
                                                    ucount = ucount + 1;
                                                    __tmp
                                                };
                                            } else {
                                                if ucount > 0 {
                                                    if ucount == 1 {
                                                        crate::string_buf::StringBuf::add(
                                                            &*({
                                                                let __b = __hx_this.borrow();
                                                                __b.buf.clone()
                                                            }),
                                                            hxrt::dynamic::from(
                                                                hxrt::string::HxString::from("n"),
                                                            ),
                                                        );
                                                    } else {
                                                        crate::string_buf::StringBuf::add(
                                                            &*({
                                                                let __b = __hx_this.borrow();
                                                                __b.buf.clone()
                                                            }),
                                                            hxrt::dynamic::from(
                                                                hxrt::string::HxString::from("u"),
                                                            ),
                                                        );
                                                        crate::string_buf::StringBuf::add(
                                                            &*({
                                                                let __b = __hx_this.borrow();
                                                                __b.buf.clone()
                                                            }),
                                                            hxrt::dynamic::from(ucount),
                                                        );
                                                    }
                                                    ucount = 0;
                                                }
                                                crate::haxe_serializer::Serializer::serialize(
                                                    &*__hx_this,
                                                    hxrt::dynamic::index_get_i32(&v, i_4),
                                                );
                                            }
                                        }
                                    }
                                    if ucount > 0 {
                                        if ucount == 1 {
                                            crate::string_buf::StringBuf::add(
                                                &*({
                                                    let __b = __hx_this.borrow();
                                                    __b.buf.clone()
                                                }),
                                                hxrt::dynamic::from(hxrt::string::HxString::from(
                                                    "n",
                                                )),
                                            );
                                        } else {
                                            crate::string_buf::StringBuf::add(
                                                &*({
                                                    let __b = __hx_this.borrow();
                                                    __b.buf.clone()
                                                }),
                                                hxrt::dynamic::from(hxrt::string::HxString::from(
                                                    "u",
                                                )),
                                            );
                                            crate::string_buf::StringBuf::add(
                                                &*({
                                                    let __b = __hx_this.borrow();
                                                    __b.buf.clone()
                                                }),
                                                hxrt::dynamic::from(ucount),
                                            );
                                        }
                                    }
                                    crate::string_buf::StringBuf::add(
                                        &*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }),
                                        hxrt::dynamic::from(hxrt::string::HxString::from("h")),
                                    );
                                } else {
                                    if __s == 0x0d3c0cadu32.clone() {
                                        let d: crate::HxRef<crate::date::Date> = {
                                            let __hx_dyn = v.clone();
                                            if __hx_dyn.is_null() {
                                                hxrt::exception::throw(hxrt::dynamic::from(
                                                    String::from("Null Access"),
                                                ))
                                            } else {
                                                __hx_dyn.downcast_ref::<crate::HxRef<crate::date::Date>>().unwrap().clone()
                                            }
                                        };
                                        crate::string_buf::StringBuf::add(
                                            &*({
                                                let __b = __hx_this.borrow();
                                                __b.buf.clone()
                                            }),
                                            hxrt::dynamic::from(hxrt::string::HxString::from("v")),
                                        );
                                        crate::string_buf::StringBuf::add(
                                            &*({
                                                let __b = __hx_this.borrow();
                                                __b.buf.clone()
                                            }),
                                            hxrt::dynamic::from(crate::date::Date::get_time(&*d)),
                                        );
                                    } else {
                                        if __s == 0x39e0cd5bu32.clone() {
                                            crate::string_buf::StringBuf::add(
                                                &*({
                                                    let __b = __hx_this.borrow();
                                                    __b.buf.clone()
                                                }),
                                                hxrt::dynamic::from(hxrt::string::HxString::from(
                                                    "q",
                                                )),
                                            );
                                            let v_8: crate::HxRef<
                                                crate::haxe_ds_int_map::IntMap<
                                                    hxrt::dynamic::Dynamic,
                                                >,
                                            > = {
                                                let __hx_dyn = v.clone();
                                                if __hx_dyn.is_null() {
                                                    hxrt::exception::throw(hxrt::dynamic::from(
                                                        String::from("Null Access"),
                                                    ))
                                                } else {
                                                    __hx_dyn
                                                        .downcast_ref::<crate::HxRef<
                                                            crate::haxe_ds_int_map::IntMap<
                                                                hxrt::dynamic::Dynamic,
                                                            >,
                                                        >>(
                                                        )
                                                        .unwrap()
                                                        .clone()
                                                }
                                            };
                                            for k_3 in crate::haxe_ds_int_map::IntMap::keys(&*v_8) {
                                                crate::string_buf::StringBuf::add(
                                                    &*({
                                                        let __b = __hx_this.borrow();
                                                        __b.buf.clone()
                                                    }),
                                                    hxrt::dynamic::from(
                                                        hxrt::string::HxString::from(":"),
                                                    ),
                                                );
                                                crate::string_buf::StringBuf::add(
                                                    &*({
                                                        let __b = __hx_this.borrow();
                                                        __b.buf.clone()
                                                    }),
                                                    hxrt::dynamic::from(k_3),
                                                );
                                                crate::haxe_serializer::Serializer::serialize(
                                                    &*__hx_this,
                                                    {
                                                        let __hx_opt =
                                                            crate::haxe_ds_int_map::IntMap::get(
                                                                &*v_8, k_3,
                                                            );
                                                        match __hx_opt {
                                                            Some(__v) => __v,
                                                            None => hxrt::dynamic::Dynamic::null(),
                                                        }
                                                    },
                                                );
                                            }
                                            crate::string_buf::StringBuf::add(
                                                &*({
                                                    let __b = __hx_this.borrow();
                                                    __b.buf.clone()
                                                }),
                                                hxrt::dynamic::from(hxrt::string::HxString::from(
                                                    "h",
                                                )),
                                            );
                                        } else {
                                            if __s == 0xd0de220eu32.clone() {
                                                crate::string_buf::StringBuf::add(
                                                    &*({
                                                        let __b = __hx_this.borrow();
                                                        __b.buf.clone()
                                                    }),
                                                    hxrt::dynamic::from(
                                                        hxrt::string::HxString::from("l"),
                                                    ),
                                                );
                                                let v_7: crate::HxRef<
                                                    crate::haxe_ds_list::List<
                                                        hxrt::dynamic::Dynamic,
                                                    >,
                                                > = {
                                                    let __hx_dyn = v.clone();
                                                    if __hx_dyn.is_null() {
                                                        hxrt::exception::throw(hxrt::dynamic::from(
                                                            String::from("Null Access"),
                                                        ))
                                                    } else {
                                                        __hx_dyn
                                                            .downcast_ref::<crate::HxRef<
                                                                crate::haxe_ds_list::List<
                                                                    hxrt::dynamic::Dynamic,
                                                                >,
                                                            >>(
                                                            )
                                                            .unwrap()
                                                            .clone()
                                                    }
                                                };
                                                for i_3 in
                                                    crate::haxe_ds_list::List::iterator(&*v_7)
                                                {
                                                    crate::haxe_serializer::Serializer::serialize(
                                                        &*__hx_this,
                                                        i_3.clone(),
                                                    );
                                                }
                                                crate::string_buf::StringBuf::add(
                                                    &*({
                                                        let __b = __hx_this.borrow();
                                                        __b.buf.clone()
                                                    }),
                                                    hxrt::dynamic::from(
                                                        hxrt::string::HxString::from("h"),
                                                    ),
                                                );
                                            } else {
                                                if __s == 0xd7e07825u32.clone() {
                                                    crate::string_buf::StringBuf::add(
                                                        &*({
                                                            let __b = __hx_this.borrow();
                                                            __b.buf.clone()
                                                        }),
                                                        hxrt::dynamic::from(
                                                            hxrt::string::HxString::from("M"),
                                                        ),
                                                    );
                                                    let v_6: crate::HxRef<
                                                        crate::haxe_ds_object_map::ObjectMap<
                                                            hxrt::dynamic::Dynamic,
                                                            hxrt::dynamic::Dynamic,
                                                        >,
                                                    > = {
                                                        let __hx_dyn = v.clone();
                                                        if __hx_dyn.is_null() {
                                                            hxrt::exception::throw(
                                                                hxrt::dynamic::from(String::from(
                                                                    "Null Access",
                                                                )),
                                                            )
                                                        } else {
                                                            __hx_dyn.downcast_ref::<crate::HxRef<crate::haxe_ds_object_map::ObjectMap<hxrt::dynamic::Dynamic, hxrt::dynamic::Dynamic>>>().unwrap().clone()
                                                        }
                                                    };
                                                    for k_2 in
                                                        crate::haxe_ds_object_map::ObjectMap::keys(
                                                            &*v_6,
                                                        )
                                                    {
                                                        crate::haxe_serializer::Serializer::serialize(&*__hx_this, k_2.clone());
                                                        crate::haxe_serializer::Serializer::serialize(&*__hx_this, {
                                            let __hx_opt = crate::haxe_ds_object_map::ObjectMap::get(&*v_6, k_2.clone());
                                            match __hx_opt {
                                                Some(__v) => __v,
                                                None => hxrt::dynamic::Dynamic::null(),
                                            }
                                        });
                                                    }
                                                    crate::string_buf::StringBuf::add(
                                                        &*({
                                                            let __b = __hx_this.borrow();
                                                            __b.buf.clone()
                                                        }),
                                                        hxrt::dynamic::from(
                                                            hxrt::string::HxString::from("h"),
                                                        ),
                                                    );
                                                } else {
                                                    if __s == 0x181f937bu32.clone() {
                                                        crate::string_buf::StringBuf::add(
                                                            &*({
                                                                let __b = __hx_this.borrow();
                                                                __b.buf.clone()
                                                            }),
                                                            hxrt::dynamic::from(
                                                                hxrt::string::HxString::from("b"),
                                                            ),
                                                        );
                                                        let v_5: crate::HxRef<
                                                            crate::haxe_ds_string_map::StringMap<
                                                                hxrt::dynamic::Dynamic,
                                                            >,
                                                        > = {
                                                            let __hx_dyn = v.clone();
                                                            if __hx_dyn.is_null() {
                                                                hxrt::exception::throw(
                                                                    hxrt::dynamic::from(
                                                                        String::from("Null Access"),
                                                                    ),
                                                                )
                                                            } else {
                                                                __hx_dyn.downcast_ref::<crate::HxRef<crate::haxe_ds_string_map::StringMap<hxrt::dynamic::Dynamic>>>().unwrap().clone()
                                                            }
                                                        };
                                                        for k in crate::haxe_ds_string_map::StringMap::keys(&*v_5) {
                                        crate::haxe_serializer::Serializer::serialize_string(&*__hx_this, hxrt::string::HxString::from(k.clone()));
                                        crate::haxe_serializer::Serializer::serialize(&*__hx_this, {
                                            let __hx_opt = crate::haxe_ds_string_map::StringMap::get(&*v_5, hxrt::string::HxString::from(k.clone()));
                                            match __hx_opt {
                                                Some(__v) => __v,
                                                None => hxrt::dynamic::Dynamic::null(),
                                            }
                                        });
                                    }
                                                        crate::string_buf::StringBuf::add(
                                                            &*({
                                                                let __b = __hx_this.borrow();
                                                                __b.buf.clone()
                                                            }),
                                                            hxrt::dynamic::from(
                                                                hxrt::string::HxString::from("h"),
                                                            ),
                                                        );
                                                    } else {
                                                        if __s == 0xc3d25954u32.clone() {
                                                            let v_4: crate::HxRef<
                                                                hxrt::bytes::Bytes,
                                                            > = {
                                                                let __hx_dyn = v.clone();
                                                                if __hx_dyn.is_null() {
                                                                    hxrt::exception::throw(
                                                                        hxrt::dynamic::from(
                                                                            String::from(
                                                                                "Null Access",
                                                                            ),
                                                                        ),
                                                                    )
                                                                } else {
                                                                    __hx_dyn.downcast_ref::<crate::HxRef<hxrt::bytes::Bytes>>().unwrap().clone()
                                                                }
                                                            };
                                                            crate::string_buf::StringBuf::add(
                                                                &*({
                                                                    let __b = __hx_this.borrow();
                                                                    __b.buf.clone()
                                                                }),
                                                                hxrt::dynamic::from(
                                                                    hxrt::string::HxString::from(
                                                                        "s",
                                                                    ),
                                                                ),
                                                            );
                                                            crate::string_buf::StringBuf::add(
                                                                &*({
                                                                    let __b = __hx_this.borrow();
                                                                    __b.buf.clone()
                                                                }),
                                                                hxrt::dynamic::from(
                                                                    ((v_4.borrow().length() * 8)
                                                                        as f64
                                                                        / 6 as f64)
                                                                        .ceil(),
                                                                ),
                                                            );
                                                            crate::string_buf::StringBuf::add(
                                                                &*({
                                                                    let __b = __hx_this.borrow();
                                                                    __b.buf.clone()
                                                                }),
                                                                hxrt::dynamic::from(
                                                                    hxrt::string::HxString::from(
                                                                        ":",
                                                                    ),
                                                                ),
                                                            );
                                                            let mut i: i32 = 0;
                                                            let max: i32 =
                                                                v_4.borrow().length() - 2;
                                                            let mut b64: hxrt::array::Array<Option<i32>> = crate::haxe_serializer::__hx_static_get_base64_codes();
                                                            if b64.is_null() {
                                                                b64 = {
                                                                    let length: i32 = hxrt::string::len(crate::haxe_serializer::__hx_static_get_base64().as_str());
                                                                    let this1: hxrt::array::Array<
                                                                        Option<i32>,
                                                                    >;
                                                                    this1 = hxrt::array::Array::<
                                                                        Option<i32>,
                                                                    >::new(
                                                                    );
                                                                    {
                                                                        let __tmp = length;
                                                                        this1.set_length_haxe(
                                                                            (if __tmp < 0 {
                                                                                0
                                                                            } else {
                                                                                __tmp
                                                                            })
                                                                                as usize,
                                                                            move || None,
                                                                        );
                                                                        __tmp
                                                                    };
                                                                    this1
                                                                };
                                                                {
                                                                    let mut _g_3: i32 = 0;
                                                                    let _g1: i32 = hxrt::string::len(crate::haxe_serializer::__hx_static_get_base64().as_str());
                                                                    while _g_3 < _g1 {
                                                                        let i_2: i32 = {
                                                                            let __tmp = _g_3;
                                                                            _g_3 = _g_3 + 1;
                                                                            __tmp
                                                                        };
                                                                        {
                                                                            let val: Option<i32> = hxrt::string::char_code_at(crate::haxe_serializer::__hx_static_get_base64().as_str(), i_2);
                                                                            {
                                                                                let __tmp = val;
                                                                                b64.set_haxe(
                                                                                    i_2 as usize,
                                                                                    __tmp,
                                                                                    move || None,
                                                                                );
                                                                                __tmp
                                                                            };
                                                                        }
                                                                    }
                                                                }
                                                                {
                                                                    let __tmp = b64.clone();
                                                                    crate::haxe_serializer::__hx_static_set_base64_codes(__tmp.clone());
                                                                    __tmp
                                                                };
                                                            }
                                                            while i < max {
                                                                let b1: i32 = v_4.borrow().get({
                                                                    let __tmp = i;
                                                                    i = i + 1;
                                                                    __tmp
                                                                });
                                                                let b2: i32 = v_4.borrow().get({
                                                                    let __tmp = i;
                                                                    i = i + 1;
                                                                    __tmp
                                                                });
                                                                let b3: i32 = v_4.borrow().get({
                                                                    let __tmp = i;
                                                                    i = i + 1;
                                                                    __tmp
                                                                });
                                                                crate::string_buf::StringBuf::add_char(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), {
                                            let __hx_opt = {
                                                let __hx_opt = b64.get((b1 >> 2) as usize);
                                                match __hx_opt {
                                                    Some(__v) => __v,
                                                    None => None,
                                                }
                                            };
                                            match &__hx_opt {
                                                Some(__v) => __v.clone(),
                                                None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                            }
                                        });
                                                                crate::string_buf::StringBuf::add_char(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), {
                                            let __hx_opt = {
                                                let __hx_opt = b64.get(((b1 << 4 | b2 >> 4) & 63) as usize);
                                                match __hx_opt {
                                                    Some(__v) => __v,
                                                    None => None,
                                                }
                                            };
                                            match &__hx_opt {
                                                Some(__v) => __v.clone(),
                                                None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                            }
                                        });
                                                                crate::string_buf::StringBuf::add_char(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), {
                                            let __hx_opt = {
                                                let __hx_opt = b64.get(((b2 << 2 | b3 >> 6) & 63) as usize);
                                                match __hx_opt {
                                                    Some(__v) => __v,
                                                    None => None,
                                                }
                                            };
                                            match &__hx_opt {
                                                Some(__v) => __v.clone(),
                                                None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                            }
                                        });
                                                                crate::string_buf::StringBuf::add_char(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), {
                                            let __hx_opt = {
                                                let __hx_opt = b64.get((b3 & 63) as usize);
                                                match __hx_opt {
                                                    Some(__v) => __v,
                                                    None => None,
                                                }
                                            };
                                            match &__hx_opt {
                                                Some(__v) => __v.clone(),
                                                None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                            }
                                        });
                                                            }
                                                            if i == max {
                                                                let b1_2: i32 = v_4.borrow().get({
                                                                    let __tmp = i;
                                                                    i = i + 1;
                                                                    __tmp
                                                                });
                                                                let b2_2: i32 = v_4.borrow().get({
                                                                    let __tmp = i;
                                                                    i = i + 1;
                                                                    __tmp
                                                                });
                                                                crate::string_buf::StringBuf::add_char(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), {
                                            let __hx_opt = {
                                                let __hx_opt = b64.get((b1_2 >> 2) as usize);
                                                match __hx_opt {
                                                    Some(__v) => __v,
                                                    None => None,
                                                }
                                            };
                                            match &__hx_opt {
                                                Some(__v) => __v.clone(),
                                                None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                            }
                                        });
                                                                crate::string_buf::StringBuf::add_char(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), {
                                            let __hx_opt = {
                                                let __hx_opt = b64.get(((b1_2 << 4 | b2_2 >> 4) & 63) as usize);
                                                match __hx_opt {
                                                    Some(__v) => __v,
                                                    None => None,
                                                }
                                            };
                                            match &__hx_opt {
                                                Some(__v) => __v.clone(),
                                                None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                            }
                                        });
                                                                crate::string_buf::StringBuf::add_char(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), {
                                            let __hx_opt = {
                                                let __hx_opt = b64.get((b2_2 << 2 & 63) as usize);
                                                match __hx_opt {
                                                    Some(__v) => __v,
                                                    None => None,
                                                }
                                            };
                                            match &__hx_opt {
                                                Some(__v) => __v.clone(),
                                                None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                            }
                                        });
                                                            } else {
                                                                if i == max + 1 {
                                                                    let b1_3: i32 =
                                                                        v_4.borrow().get({
                                                                            let __tmp = i;
                                                                            i = i + 1;
                                                                            __tmp
                                                                        });
                                                                    crate::string_buf::StringBuf::add_char(&*({
                                                let __b = __hx_this.borrow();
                                                __b.buf.clone()
                                            }), {
                                                let __hx_opt = {
                                                    let __hx_opt = b64.get((b1_3 >> 2) as usize);
                                                    match __hx_opt {
                                                        Some(__v) => __v,
                                                        None => None,
                                                    }
                                                };
                                                match &__hx_opt {
                                                    Some(__v) => __v.clone(),
                                                    None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                                }
                                            });
                                                                    crate::string_buf::StringBuf::add_char(&*({
                                                let __b = __hx_this.borrow();
                                                __b.buf.clone()
                                            }), {
                                                let __hx_opt = {
                                                    let __hx_opt = b64.get((b1_3 << 4 & 63) as usize);
                                                    match __hx_opt {
                                                        Some(__v) => __v,
                                                        None => None,
                                                    }
                                                };
                                                match &__hx_opt {
                                                    Some(__v) => __v.clone(),
                                                    None => hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))),
                                                }
                                            });
                                                                }
                                                            }
                                                        } else {
                                                            if {
                                                                let __b = __hx_this.borrow();
                                                                __b.use_cache
                                                            } {
                                                                ({
                                                                    let __b = __hx_this.borrow();
                                                                    __b.cache.clone()
                                                                })
                                                                .pop();
                                                            }
                                                            if !hxrt::dynamic::field_get(
                                                                &v,
                                                                "hxSerialize",
                                                            )
                                                            .is_null()
                                                            {
                                                                crate::string_buf::StringBuf::add(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), hxrt::dynamic::from(hxrt::string::HxString::from("C")));
                                                                crate::haxe_serializer::Serializer::serialize_string(&*__hx_this, hxrt::string::HxString::from({
                                            let _ = c;
                                            String::from("<unknown class>")
                                        }));
                                                                if {
                                                                    let __b = __hx_this.borrow();
                                                                    __b.use_cache
                                                                } {
                                                                    ({
                                                                        let __b =
                                                                            __hx_this.borrow();
                                                                        __b.cache.clone()
                                                                    })
                                                                    .push(v.clone());
                                                                }
                                                                {
                                                                    let __hx_dyn =
                                                                        hxrt::dynamic::field_get(
                                                                            &v,
                                                                            "hxSerialize",
                                                                        );
                                                                    let __hx_f = __hx_dyn.downcast_ref::<crate::HxDynRef<dyn Fn(crate::HxRef<crate::haxe_serializer::Serializer>) -> hxrt::dynamic::Dynamic + Send + Sync>>();
                                                                    if __hx_dyn.is_null() {
                                                                        hxrt::exception::throw(
                                                                            hxrt::dynamic::from(
                                                                                String::from(
                                                                                    "Null Access",
                                                                                ),
                                                                            ),
                                                                        )
                                                                    } else {
                                                                        if __hx_f.is_some() {
                                                                            __hx_f.unwrap().clone()(
                                                                                __hx_this.clone(),
                                                                            )
                                                                        } else {
                                                                            hxrt::exception::throw(hxrt::dynamic::from(String::from("Dynamic call on non-function value")))
                                                                        }
                                                                    }
                                                                };
                                                                crate::string_buf::StringBuf::add(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), hxrt::dynamic::from(hxrt::string::HxString::from("g")));
                                                            } else {
                                                                crate::string_buf::StringBuf::add(&*({
                                            let __b = __hx_this.borrow();
                                            __b.buf.clone()
                                        }), hxrt::dynamic::from(hxrt::string::HxString::from("c")));
                                                                crate::haxe_serializer::Serializer::serialize_string(&*__hx_this, hxrt::string::HxString::from({
                                            let _ = c;
                                            String::from("<unknown class>")
                                        }));
                                                                if {
                                                                    let __b = __hx_this.borrow();
                                                                    __b.use_cache
                                                                } {
                                                                    ({
                                                                        let __b =
                                                                            __hx_this.borrow();
                                                                        __b.cache.clone()
                                                                    })
                                                                    .push(v.clone());
                                                                }
                                                                crate::haxe_serializer::Serializer::serialize_fields(&*__hx_this, {
                                            let __hx_dyn = v.clone();
                                            if __hx_dyn.is_null() { hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access"))) } else { __hx_dyn.downcast_ref::<crate::HxRef<hxrt::anon::Anon>>().unwrap().clone() }
                                        });
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                crate::value_type::ValueType::TEnum(__p) => {
                    let _g_5: u32 = __p;
                    {
                        let e: u32 = _g_5;
                        {
                            if {
                                let __b = __hx_this.borrow();
                                __b.use_cache
                            } {
                                if crate::haxe_serializer::Serializer::serialize_ref(
                                    &*__hx_this,
                                    v.clone(),
                                ) {
                                    return;
                                }
                                ({
                                    let __b = __hx_this.borrow();
                                    __b.cache.clone()
                                })
                                .pop();
                            }
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                if {
                                    let __b = __hx_this.borrow();
                                    __b.use_enum_index
                                } {
                                    hxrt::dynamic::from(hxrt::string::HxString::from("j"))
                                } else {
                                    hxrt::dynamic::from(hxrt::string::HxString::from("w"))
                                },
                            );
                            crate::haxe_serializer::Serializer::serialize_string(
                                &*__hx_this,
                                hxrt::string::HxString::from({
                                    let _ = e;
                                    String::from("<unknown enum>")
                                }),
                            );
                            if {
                                let __b = __hx_this.borrow();
                                __b.use_enum_index
                            } {
                                crate::string_buf::StringBuf::add(
                                    &*({
                                        let __b = __hx_this.borrow();
                                        __b.buf.clone()
                                    }),
                                    hxrt::dynamic::from(hxrt::string::HxString::from(":")),
                                );
                                crate::string_buf::StringBuf::add(
                                    &*({
                                        let __b = __hx_this.borrow();
                                        __b.buf.clone()
                                    }),
                                    hxrt::dynamic::index_get_i32(&v, 1),
                                );
                            } else {
                                crate::haxe_serializer::Serializer::serialize_string(
                                    &*__hx_this,
                                    hxrt::string::HxString::from({
                                        let __hx_dyn = hxrt::dynamic::index_get_i32(&v, 0);
                                        if __hx_dyn.is_null() {
                                            hxrt::string::HxString::null()
                                        } else {
                                            if __hx_dyn.downcast_ref::<String>().is_some() {
                                                hxrt::string::HxString::from(
                                                    __hx_dyn
                                                        .downcast_ref::<String>()
                                                        .unwrap()
                                                        .clone(),
                                                )
                                            } else {
                                                if __hx_dyn
                                                    .downcast_ref::<hxrt::string::HxString>()
                                                    .is_some()
                                                {
                                                    __hx_dyn
                                                        .downcast_ref::<hxrt::string::HxString>()
                                                        .unwrap()
                                                        .clone()
                                                } else {
                                                    hxrt::exception::throw(hxrt::dynamic::from(
                                                        String::from("Null Access"),
                                                    ))
                                                }
                                            }
                                        }
                                    }),
                                );
                            }
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                hxrt::dynamic::from(hxrt::string::HxString::from(":")),
                            );
                            let l_2: i32 = {
                                let __hx_dyn = hxrt::dynamic::index_get_str(
                                    &v,
                                    hxrt::string::HxString::from("length").as_str(),
                                );
                                if __hx_dyn.is_null() {
                                    hxrt::exception::throw(hxrt::dynamic::from(String::from(
                                        "Null Access",
                                    )))
                                } else {
                                    __hx_dyn.downcast_ref::<i32>().unwrap().clone()
                                }
                            };
                            crate::string_buf::StringBuf::add(
                                &*({
                                    let __b = __hx_this.borrow();
                                    __b.buf.clone()
                                }),
                                hxrt::dynamic::from(l_2 - 2),
                            );
                            {
                                let mut _g_6: i32 = 2;
                                let _g1_3: i32 = l_2;
                                while _g_6 < _g1_3 {
                                    let i_5: i32 = {
                                        let __tmp = _g_6;
                                        _g_6 = _g_6 + 1;
                                        __tmp
                                    };
                                    crate::haxe_serializer::Serializer::serialize(
                                        &*__hx_this,
                                        hxrt::dynamic::index_get_i32(&v, i_5),
                                    );
                                }
                            }
                            if {
                                let __b = __hx_this.borrow();
                                __b.use_cache
                            } {
                                ({
                                    let __b = __hx_this.borrow();
                                    __b.cache.clone()
                                })
                                .push(v.clone());
                            }
                        }
                    }
                }
                _ => {
                    hxrt::exception::throw(hxrt::dynamic::from(hxrt::string::HxString::from(
                        format!(
                            "{}{}",
                            "Cannot serialize ",
                            hxrt::string::HxString::from(v.to_haxe_string())
                        ),
                    )));
                }
            }
        }
    }

    pub fn run(v: hxrt::dynamic::Dynamic) -> hxrt::string::HxString {
        let s: crate::HxRef<crate::haxe_serializer::Serializer> =
            crate::haxe_serializer::Serializer::new();
        crate::haxe_serializer::Serializer::serialize(&*s, v.clone());
        return hxrt::string::HxString::from(crate::haxe_serializer::Serializer::to_string(&*s));
    }
}
