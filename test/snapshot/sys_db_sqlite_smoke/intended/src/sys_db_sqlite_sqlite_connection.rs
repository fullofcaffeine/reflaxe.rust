// Generated by reflaxe.rust (POC)

pub const __HX_TYPE_ID: u32 = 0x905152c9u32;

#[derive(Debug)]

pub struct SqliteConnection {
    handle: crate::HxRef<crate::db_sqlite_driver::SqliteConnectionHandle>,
}

impl SqliteConnection {
    pub fn new(
        file: hxrt::string::HxString,
    ) -> crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> {
        let self_: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            crate::HxRef::new(SqliteConnection {
                handle: crate::db_sqlite_driver::open_handle(hxrt::string::HxString::from(
                    file.clone(),
                )),
            });
        return self_;
    }

    pub fn close(self_: &crate::HxRefCell<SqliteConnection>) {
        let __hx_this: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            self_.self_ref();
        crate::db_sqlite_driver::close_handle(
            &({
                let __b = __hx_this.borrow();
                __b.handle.clone()
            }),
        );
    }

    pub fn request(
        self_: &crate::HxRefCell<SqliteConnection>,
        sql: hxrt::string::HxString,
    ) -> crate::HxRc<dyn crate::sys_db_result_set::ResultSet + Send + Sync> {
        let __hx_this: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            self_.self_ref();
        let res: crate::HxRef<hxrt::db::QueryResult> = crate::db_sqlite_driver::request(
            &({
                let __b = __hx_this.borrow();
                __b.handle.clone()
            }),
            &sql,
        );
        return {
            let __tmp = crate::sys_db_sqlite_sqlite_result_set::SqliteResultSet::new(res.clone());
            let __up: crate::HxRc<dyn crate::sys_db_result_set::ResultSet + Send + Sync> =
                match __tmp.as_arc_opt() {
                    Some(__rc) => __rc.clone(),
                    None => {
                        hxrt::exception::throw(hxrt::dynamic::from(String::from("Null Access")))
                    }
                };
            __up
        };
    }

    pub fn escape(
        _self_: &crate::HxRefCell<SqliteConnection>,
        s: hxrt::string::HxString,
    ) -> hxrt::string::HxString {
        return hxrt::string::HxString::from(hxrt::string::HxString::from(
            hxrt::string::split_hx(
                s.as_str(),
                hxrt::string::HxString::from(hxrt::string::HxString::from("'")).as_str(),
            )
            .join(hxrt::string::HxString::from(hxrt::string::HxString::from(
                "''",
            ))),
        ));
    }

    pub fn quote(
        self_: &crate::HxRefCell<SqliteConnection>,
        s: hxrt::string::HxString,
    ) -> hxrt::string::HxString {
        let __hx_this: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            self_.self_ref();
        return hxrt::string::HxString::from(hxrt::string::HxString::from(format!(
            "{}{}{}",
            "'",
            crate::sys_db_sqlite_sqlite_connection::SqliteConnection::escape(
                &*__hx_this,
                hxrt::string::HxString::from(s)
            ),
            "'"
        )));
    }

    pub fn add_value(
        _self_: &crate::HxRefCell<SqliteConnection>,
        sb: crate::HxRef<crate::string_buf::StringBuf>,
        v: hxrt::dynamic::Dynamic,
    ) {
        crate::string_buf::StringBuf::add(
            &*sb,
            hxrt::dynamic::from(crate::db_sqlite_driver::render_sql_value(v.clone())),
        );
    }

    pub fn last_insert_id(self_: &crate::HxRefCell<SqliteConnection>) -> i32 {
        let __hx_this: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            self_.self_ref();
        return crate::db_sqlite_driver::last_insert_id(
            &({
                let __b = __hx_this.borrow();
                __b.handle.clone()
            }),
        );
    }

    pub fn db_name(_self_: &crate::HxRefCell<SqliteConnection>) -> hxrt::string::HxString {
        return hxrt::string::HxString::from(hxrt::string::HxString::from("SQLite"));
    }

    pub fn start_transaction(self_: &crate::HxRefCell<SqliteConnection>) {
        let __hx_this: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            self_.self_ref();
        crate::sys_db_sqlite_sqlite_connection::SqliteConnection::request(
            &*__hx_this,
            hxrt::string::HxString::from(hxrt::string::HxString::from("BEGIN TRANSACTION")),
        );
    }

    pub fn commit(self_: &crate::HxRefCell<SqliteConnection>) {
        let __hx_this: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            self_.self_ref();
        crate::sys_db_sqlite_sqlite_connection::SqliteConnection::request(
            &*__hx_this,
            hxrt::string::HxString::from(hxrt::string::HxString::from("COMMIT")),
        );
    }

    pub fn rollback(self_: &crate::HxRefCell<SqliteConnection>) {
        let __hx_this: crate::HxRef<crate::sys_db_sqlite_sqlite_connection::SqliteConnection> =
            self_.self_ref();
        crate::sys_db_sqlite_sqlite_connection::SqliteConnection::request(
            &*__hx_this,
            hxrt::string::HxString::from(hxrt::string::HxString::from("ROLLBACK")),
        );
    }
}

impl crate::sys_db_connection::Connection for crate::HxRefCell<SqliteConnection> {
    fn request(
        &self,
        s: hxrt::string::HxString,
    ) -> crate::HxRc<dyn crate::sys_db_result_set::ResultSet + Send + Sync> {
        SqliteConnection::request(self, s)
    }
    fn close(&self) -> () {
        SqliteConnection::close(self)
    }
    fn escape(&self, s: hxrt::string::HxString) -> hxrt::string::HxString {
        SqliteConnection::escape(self, s)
    }
    fn quote(&self, s: hxrt::string::HxString) -> hxrt::string::HxString {
        SqliteConnection::quote(self, s)
    }
    fn add_value(
        &self,
        s: crate::HxRef<crate::string_buf::StringBuf>,
        v: hxrt::dynamic::Dynamic,
    ) -> () {
        SqliteConnection::add_value(self, s, v)
    }
    fn last_insert_id(&self) -> i32 {
        SqliteConnection::last_insert_id(self)
    }
    fn db_name(&self) -> hxrt::string::HxString {
        SqliteConnection::db_name(self)
    }
    fn start_transaction(&self) -> () {
        SqliteConnection::start_transaction(self)
    }
    fn commit(&self) -> () {
        SqliteConnection::commit(self)
    }
    fn rollback(&self) -> () {
        SqliteConnection::rollback(self)
    }
    fn __hx_type_id(&self) -> u32 {
        crate::sys_db_sqlite_sqlite_connection::__HX_TYPE_ID
    }
}
