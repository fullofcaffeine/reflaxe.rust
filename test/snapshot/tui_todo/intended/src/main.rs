// Generated by reflaxe.rust (POC)

use std::cell::RefCell;
use std::rc::Rc;

type HxRef<T> = Rc<RefCell<T>>;

mod action;
mod task;
mod tui_demo;
use crate::action::Action;
use crate::task::Task;

fn main() {
    let mut tasks: Vec<HxRef<Task>> = vec![
        Task::new(String::from("bootstrap reflaxe.rust"), true),
        Task::new(String::from("add enums + switch"), false),
        Task::new(String::from("ship ratatui demo"), false),
    ];
    let mut actions: Vec<Action> = vec![
        Action::Down,
        Action::Toggle,
        Action::Down,
        Action::Toggle,
        Action::Up,
        Action::Quit,
    ];
    let mut selected: i32 = 0;
    let mut frame: i32 = 0;
    let mut i: i32 = 0;
    while i < actions.len() as i32 {
        let mut action: Action = actions[i as usize].clone();
        match action.clone() {
            Action::Up => {
                if selected > 0 {
                    selected = selected - 1
                };
            }
            Action::Down => {
                if selected < tasks.len() as i32 - 1 {
                    selected = selected + 1
                };
            }
            Action::Toggle => {
                Task::toggle(&tasks[selected as usize].clone());
            }
            Action::Quit => {
                break;
            }
        };
        let mut lines: String = String::from("");
        let mut j: i32 = 0;
        while j < tasks.len() as i32 {
            lines = format!(
                "{}{}",
                format!(
                    "{}{}",
                    lines,
                    Task::line(&tasks[j as usize].clone(), j == selected)
                ),
                String::from("\n")
            );
            j = j + 1;
        }
        crate::tui_demo::run_frame(frame, lines.clone());
        frame = frame + 1;
        i = i + 1;
    }
}
